{% extends "base.html" %}

{% block content %}
<section class="section hero">
    <div class="container grid grid-2" style="align-items: center;">
        <div class="hero-content fade-in">
            <h1 style="color: var(--primary-color);">AI-Powered Brain Scan Analysis</h1>
            <p style="font-size: 1.2rem; color: var(--text-secondary); margin-bottom: var(--sp-xl);">
                Instantly detect abnormalities in MRI scans with clinical-grade accuracy using our advanced deep
                learning models.
            </p>
            <div style="display: flex; gap: var(--sp-md);">
                <button onclick="document.getElementById('upload-section').scrollIntoView({behavior: 'smooth'})"
                    class="btn btn-primary">
                    Start Analysis <i class="fas fa-arrow-right"></i>
                </button>
                <a href="{{ url_for('main.about') }}" class="btn btn-secondary">Learn More</a>
            </div>

            <div class="mt-lg" style="display: flex; gap: var(--sp-lg);">
                <div>
                    <h3 style="margin-bottom: 0; color: var(--primary-color);">99.2%</h3>
                    <p style="font-size: 0.9rem;">Accuracy</p>
                </div>
                <div>
                    <h3 style="margin-bottom: 0; color: var(--primary-color);">2.4s</h3>
                    <p style="font-size: 0.9rem;">Processing Time</p>
                </div>
                <div>
                    <h3 style="margin-bottom: 0; color: var(--primary-color);">10k+</h3>
                    <p style="font-size: 0.9rem;">Scans Analyzed</p>
                </div>
            </div>
        </div>
        <div class="hero-image fade-in" style="animation-delay: 0.2s; text-align: center;">
            <!-- Abstract Medical Visualization Placeholder -->
            <div
                style="background: linear-gradient(135deg, #E6FCFF 0%, #F4F5F7 100%); border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%; width: 100%; padding-top: 100%; position: relative; box-shadow: var(--shadow-lg);">
                <i class="fas fa-brain"
                    style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 8rem; color: var(--primary-light); opacity: 0.8;"></i>
            </div>
        </div>
    </div>
</section>

<section id="upload-section" class="section" style="background-color: var(--surface-white);">
    <div class="container">
        <div class="text-center mb-lg">
            <h2>Upload MRI Scan</h2>
            <p>Securely upload patient scans for immediate AI interpretation.</p>
        </div>

        <div class="card" style="max-width: 800px; margin: 0 auto;">
            <!-- Upload Area -->
            <div id="upload-area" class="upload-zone"
                style="border: 2px dashed var(--primary-light); border-radius: var(--radius-lg); padding: var(--sp-3xl); text-align: center; cursor: pointer; transition: background 0.3s;">
                <input type="file" id="file-input" accept=".jpg,.jpeg,.png,.dcm,.nii,.nii.gz" hidden>
                <div style="font-size: 3rem; color: var(--primary-light); margin-bottom: var(--sp-md);">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <h3>Drag & Drop MRI Scan Here</h3>
                <p style="color: var(--text-secondary);">or click to browse files</p>
                <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: var(--sp-md);">
                    Supported: JPEG, PNG, DICOM, NIfTI
                </p>
            </div>

            <!-- Preview & Analysis Area (Hidden initially) -->
            <div id="upload-preview" style="display: none; padding-top: var(--sp-xl);">
                <div class="grid grid-2">
                    <div>
                        <h4>Selected Scan</h4>
                        <div style="border-radius: var(--radius-md); overflow: hidden; box-shadow: var(--shadow-md);">
                            <img id="preview-image" src="" alt="Preview" style="width: 100%; height: auto;">
                        </div>
                        <button id="change-image-btn" class="btn btn-secondary mt-lg" style="width: 100%;">Change
                            Image</button>
                    </div>
                    <div style="display: flex; flex-direction: column; justify-content: center; align-items: center;">
                        <button id="analyze-btn" class="btn btn-primary" style="padding: 16px 32px; font-size: 1.2rem;">
                            <i class="fas fa-microscope"></i> Analyze Scan
                        </button>
                        <p style="margin-top: var(--sp-md); font-size: 0.9rem; color: var(--text-muted);">
                            Expected time: ~2 seconds
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Analysis Results (Hidden initially) -->
<section id="results-container" class="section" style="display: none;">
    <div class="container">
        <div class="text-center mb-lg">
            <h2>Analysis Report</h2>
            <p>AI-generated clinical insights.</p>
        </div>

        <!-- Loading State -->
        <div id="loading-indicator" style="text-align: center; display: none;">
            <div class="spinner" style="font-size: 3rem; color: var(--primary-color); margin-bottom: var(--sp-md);">
                <i class="fas fa-circle-notch fa-spin"></i>
            </div>
            <h3>Analyzing Neural Patterns...</h3>
            <p>Please wait while our models process the imagery.</p>
        </div>

        <!-- Results Content -->
        <div id="results-content" style="display: none;">
            <div class="grid grid-2">
                <!-- Visuals Column -->
                <div class="card">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--sp-md);">
                        <h3>Visual Findings</h3>
                        <div
                            style="background: var(--bg-body); padding: 4px; border-radius: var(--radius-pill); display: flex;">
                            <button class="btn btn-small" id="toggle-original"
                                style="background: var(--surface-white); box-shadow: var(--shadow-sm);">Original</button>
                            <button class="btn btn-small" id="toggle-heatmap"
                                style="background: transparent;">Heatmap</button>
                        </div>
                    </div>
                    <div
                        style="position: relative; border-radius: var(--radius-md); overflow: hidden; min-height: 300px; background: #000;">
                        <img id="result-original" src="" alt="Original" style="width: 100%; display: block;">
                        <img id="result-heatmap" src="" alt="Heatmap"
                            style="width: 100%; display: none; position: absolute; top: 0; left: 0;">
                    </div>
                    <p style="margin-top: var(--sp-md); font-size: 0.9rem; color: var(--text-secondary);">
                        <i class="fas fa-info-circle"></i> The heatmap highlights regions of interest identified by the
                        neural network.
                    </p>
                </div>

                <!-- Data Column -->
                <div style="display: flex; flex-direction: column; gap: var(--sp-lg);">
                    <!-- Primary Finding Card -->
                    <div class="card" style="border-left: 6px solid var(--primary-color);">
                        <p
                            style="text-transform: uppercase; letter-spacing: 1px; font-size: 0.8rem; color: var(--text-secondary); margin-bottom: var(--sp-xs);">
                            Primary Diagnosis</p>
                        <h2 id="result-class"
                            style="color: var(--primary-color); font-size: 2.5rem; margin-bottom: var(--sp-xs);"></h2>
                        <div style="display: flex; align-items: center; gap: var(--sp-sm);">
                            <span id="result-confidence" style="font-weight: 700; font-size: 1.2rem;"></span>
                            <span style="color: var(--text-secondary);">Confidence</span>
                        </div>
                    </div>

                    <!-- Details Card -->
                    <div class="card">
                        <h3>Detailed Probability</h3>
                        <div id="confidence-chart" style="margin-top: var(--sp-md);">
                            <!-- Insert bars dynamically via JS or simpler placeholders -->
                            <p style="color: var(--text-muted);">Confidence distribution across classes.</p>
                        </div>
                        <div
                            style="margin-top: var(--sp-lg); padding-top: var(--sp-lg); border-top: 1px solid var(--bg-body);">
                            <p><strong>Processing Time:</strong> <span id="result-time"></span></p>
                            <p><strong>Model:</strong> {{ model_details.name }} ({{ model_details.type }})</p>
                        </div>
                    </div>

                    <div style="margin-top: auto;">
                        <button id="new-analysis-btn" class="btn btn-secondary" style="width: 100%;">
                            <i class="fas fa-redo"></i> Analyze Another Scan
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/home.js') }}"></script>
<script>
    // Simple toggle logic for images (can be moved to main js)
    const originalBtn = document.getElementById('toggle-original');
    const heatmapBtn = document.getElementById('toggle-heatmap');
    const imgOriginal = document.getElementById('result-original');
    const imgHeatmap = document.getElementById('result-heatmap');

    if (originalBtn && heatmapBtn) {
        originalBtn.addEventListener('click', () => {
            imgOriginal.style.display = 'block';
            imgHeatmap.style.display = 'none';
            originalBtn.style.background = 'var(--surface-white)';
            originalBtn.style.boxShadow = 'var(--shadow-sm)';
            heatmapBtn.style.background = 'transparent';
            heatmapBtn.style.boxShadow = 'none';
        });

        heatmapBtn.addEventListener('click', () => {
            imgOriginal.style.display = 'block'; // Keep original as base size ref if needed, or absolute
            imgHeatmap.style.display = 'block';
            heatmapBtn.style.background = 'var(--surface-white)';
            heatmapBtn.style.boxShadow = 'var(--shadow-sm)';
            originalBtn.style.background = 'transparent';
            originalBtn.style.boxShadow = 'none';
        });
    }
</script>
{% endblock %}